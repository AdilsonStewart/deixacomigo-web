import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import './Sucesso2.css';

const Sucesso2 = () => {
  const navigate = useNavigate();
  const [userData, setUserData] = useState(null);

  useEffect(() => {
    // âœ… PEGAR DADOS DO USUÃRIO DO LOCALSTORAGE
    const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
    
    if (user.cadastroCompleto) {
      setUserData(user);
      // âœ… REDIRECIONAMENTO AUTOMÃTICO APÃ“S 2 SEGUNDOS
      setTimeout(() => {
        navigate('/videorecorder', { state: { userId: user.id } });
      }, 2000);
    } else {
      // âŒ SE NÃƒO ESTIVER CADASTRADO, VOLTA PARA CADASTRO
      alert('âŒ Cadastro nÃ£o encontrado. Complete seu cadastro.');
      navigate('/cadastro');
    }
  }, [navigate]);

  if (!userData) {
    return <div className="sucesso2-container">Carregando...</div>;
  }

  return (
    <div className="sucesso2-container">
      <img
        className="sucesso2-gif"
        src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExbDg4aHBpM2V0cG50N2phN3R0M2txdzZkY3hucDJpN2gyNmlrYzV4NCZlcD12MV9pbnRlcm5albF9naWZfYnlfaWQmY3Q9Zw/26xBIygOcC3bAWg3S/giphy.gif"
        alt="Sucesso"
      />

      <h1>Pagamento Aprovado! ğŸ‰</h1>
      
      <div className="usuario-cumprimento">
        <h3>OlÃ¡, {userData.nome}! ğŸ‘‹</h3>
        <p>Seu pagamento foi confirmado com sucesso!</p>
        <p>Redirecionando para gravaÃ§Ã£o em 2 segundos...</p>
      </div>

      <button 
        className="btn-continuar"
        onClick={() => navigate('/videorecorder', { state: { userId: userData.id } })}
      >
        ğŸ¥ Ir para GravaÃ§Ã£o Agora
      </button>
    </div>
  );
};

export default Sucesso2;
